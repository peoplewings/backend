{% extends "people/base_people.html" %}
{% block content_title %}
<div class="subnav span12">
    <ul class="nav nav-pills">
      <li><a href="../basic">Basic info</a></li>
	  <li class="active"><a href="#">Location</a></li>
      <li><a href="../about">About me</a></li>
      <li><a href="../likes">Likes</a></li>
      <li><a href="../contact">Contact info</a></li>
      <li><a href="../travels">Travels</a></li>
    </ul>
  </div>
{% endblock %}
{% block content %}

<div>
    <div class="entry">
        <form id="my-form" method="post" action="" class="well form-horizontal span12">
            {% csrf_token %}
			{{ formset1.management_form }}
			{% for form in formset1 %}

					{% include "general/custom_fieldset.html" %}
            
	        {% endfor %}
		<div class="form-actions">
			<button type="reset" class="btn" style="margin-left: 160px">Cancel</button>
			<button type="submit" class="btn btn-primary" style="margin-left: 160px">Submit</button>
		</div>
        </form>
    </div>
</div>

{% endblock %}

{% block page_scripting %}
{% load static from staticfiles %}
<script>
  	$(document).ready(function(){
		console.log('Hello JS again Location Info')
		$.markers = []		
		var mapcanvas = $( document.createElement('div') ); 
		mapcanvas.attr({ id: 'mapcanvas', style: 'height:300px;margin-left:160px;'}).addClass('span6');
		$('fieldset:last').append(mapcanvas)
		var latlng = new google.maps.LatLng(0,0);
		var myOptions = {
		   zoom: 1,
		   center: latlng,
		   mapTypeControl: false,
           streetViewControl: false,
		   navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
		   mapTypeId: google.maps.MapTypeId.ROADMAP
		 };
		 var map = new google.maps.Map(document.getElementById("mapcanvas"), myOptions);
		
		var options = {
       		types: ['(cities)'],
       		//componentRestrictions: {country: "es"}
		};
		
		var home = document.getElementById("id_form-0-hometown");
		var auto_home = new google.maps.places.Autocomplete(home, options);
		var current = document.getElementById("id_form-0-current_city");
		var auto_current = new google.maps.places.Autocomplete(current, options);
		
		google.maps.event.addListener(auto_home, 'place_changed', 	function() {
          		console.log('place_changed hometown')
				var place = auto_home.getPlace();
				var image = '{% static "img/marker-blue.png" %}';
	            map.setCenter(place.geometry.location);
				if (!$.homeMarker){
					$.homeMarker = new google.maps.Marker({
                	map: map,
                	position: place.geometry.location,
					icon: image
            		});
				} else $.homeMarker.setPosition(place.geometry.location)			
			});
			
			google.maps.event.addListener(auto_current, 'place_changed', 	function() {
          		console.log('place_changed current')
				var place = auto_current.getPlace();
				var image = '{% static "img/marker-blue.png" %}';
	            map.setCenter(place.geometry.location);
				if (!$.currentMarker){
					$.currentMarker = new google.maps.Marker({
                	map: map,
                	position: place.geometry.location,
					icon: image
            		});
				} else $.currentMarker.setPosition(place.geometry.location)			
			});
			
			$("#id_form-0-hometown").keypress(function(event) {
				if ( event.which == 13 ) {
     				event.preventDefault();
   				}
			})
			$("#id_form-0-current_city").keypress(function(event) {
  				if ( event.which == 13 ) {
     				event.preventDefault();
   				}
			})
	  });
</script>
{% endblock %}