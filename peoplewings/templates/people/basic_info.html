{% extends "people/base_people.html" %}
{% block content_title %}
<div class="subnav span12">
    <ul class="nav nav-pills">
      <li class="active"><a href="#">Basic info</a></li>
	  <li><a href="../location">Location</a></li>
      <li><a href="../about">About me</a></li>
      <li><a href="../likes">Likes</a></li>
      <li><a href="../contact">Contact info</a></li>
      <li><a href="../travels">Travels</a></li>
    </ul>
  </div>
{% endblock %}
{% load static from staticfiles %}
{% block content %}

<div>
    <div class="entry">
        <form id="my-form" method="post" action="" class="well form-horizontal span8">
            {% csrf_token %}
			{{ formset.management_form }}
			{% for form in formset %}

					{% include "general/custom_fieldset.html" %}
            
	        {% endfor %}
			{{ langset.management_form }}
			{% for form in langset %}

					{% include "general/custom_fieldset.html" with errors=langset.non_form_errors %}
            
	        {% endfor %}
		<div class="form-actions">
			<button type="reset" class="btn" style="margin-left: 160px">Cancel</button>
			<button type="submit" class="btn btn-primary" style="margin-left: 160px">Submit</button>
		</div>
        </form>
		<ul class="thumbnails">
            <li class="span4">
              <a href="#" class="thumbnail">
                <img id="avatar" src="/media/avatar.jpg" alt="">
			    <div class="progress progress-striped"  style="margin-top:10px;display:none;">
  					<div class="bar" style="width: 0%;"></div>
			  	</div>
              </a>
            </li>
            <li class="span4">
				<form id="file-form" method="post" action="" enctype="multipart/form-data">
				<input class="span4" type="file" id="files" name="files[]" />
				<output id="list"></output>
				</form>
			</li>
			<li class="span2">
              <a href="#" class="thumbnail">
                <img src="http://placehold.it/160x120" alt="">
              </a>
            </li>
			<li class="span2">
              <a href="#" class="thumbnail">
                <img src="http://placehold.it/160x120" alt="">
              </a>
            </li>
          </ul>
    </div>
</div>

{% endblock %}

{% block page_scripting %}
	<script type="text/javascript">
           $(function() {
               $('#my-form > fieldset[id^=lang]').formset({'prefix': '{{ langset.prefix }}'});
				if (window.File && window.FileReader && window.FileList && window.Blob) {
  					function handleFileSelect(evt) {
    					var files = evt.target.files; // FileList object
					    // files is a FileList of File objects. List some properties.
					    var output = [];
					    for (var i = 0, f; f = files[i]; i++) {
					      output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
					                  f.size, ' bytes, last modified: ',
					                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
					                  '</li>');
					    }
					    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
					    uploadFile(evt.target.files[0])
					  }

					  document.getElementById('files').addEventListener('change', handleFileSelect, false);
				} else {
  					alert('The File APIs are not fully supported in this browser.');
				}
				function uploadFile(file) {
					
	       			var fd = new FormData();
				    fd.append("fileToUpload", file);
					fd.append("csrfmiddlewaretoken", $("input[name=csrfmiddlewaretoken]").attr('value'))
				    var xhr = new XMLHttpRequest();
				    xhr.upload.addEventListener("progress", uploadProgress, false);
				    xhr.addEventListener("load", uploadComplete, false);
				    xhr.addEventListener("error", uploadFailed, false);
				    xhr.addEventListener("abort", uploadCanceled, false);
				    xhr.open("POST", "/ajax/upload/image/");
					$('.progress').show()
				    xhr.send(fd);
			    }
				function uploadProgress(evt) {
			        if (evt.lengthComputable) {
			          var percentComplete = Math.round(evt.loaded * 100 / evt.total);
			
			          $('.progress > .bar').attr( { "style": "width:" + percentComplete.toString() + "%" });
			        }
			        else {
			          document.getElementById('progressNumber').innerHTML = 'unable to compute';
			        }
			      }

			      function uploadComplete(evt) {
			        /* This event is raised when the server send back a response */
			         //$(document).innerHTML = evt.target.responseText
					console.dir(evt)
					$('.progress').hide()
					$('#avatar').attr("src", "/media/avatar.jpg")
			         console.log(evt.target.responseText);
			      }

			      function uploadFailed(evt) {
			        alert("There was an error attempting to upload the file.");
			      }

			      function uploadCanceled(evt) {
			        alert("The upload has been canceled by the user or the browser dropped the connection.");
			      }
           })
    </script>
{% endblock %}